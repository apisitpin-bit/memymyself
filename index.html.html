<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Sentence Master (40 Questions)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&family=Fredoka:wght@400;600&family=Pinyon+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        .eng-font { font-family: 'Fredoka', sans-serif; }
        .cert-font { font-family: 'Pinyon Script', cursive; }
        
        /* Drag Slots */
        .slot {
            transition: all 0.2s;
            border: 2px dashed #94a3b8;
            background: #f8fafc;
        }
        .slot.filled {
            border: 2px solid #3b82f6;
            background: #eff6ff;
        }
        
        /* Certificate Design */
        .certificate-container {
            border: 8px solid #b45309;
            padding: 5px;
            background: #fff;
            position: relative;
            overflow: hidden;
        }
        .certificate-inner {
            border: 2px solid #d97706;
            padding: 2rem;
            background-image: radial-gradient(circle at center, rgba(255,255,255,0.8), rgba(254,243,199,0.5));
            position: relative;
            z-index: 10;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 8rem;
            opacity: 0.05;
            color: #000;
            z-index: 0;
            white-space: nowrap;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-4">

    <!-- SCREEN 1: LOGIN -->
    <div id="login-screen" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border-t-8 border-indigo-600 animate-fade-in">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-indigo-700">üéì Sentence Master</h1>
            <p class="text-gray-500">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (40 ‡∏Ç‡πâ‡∏≠)</p>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ø)</label>
                <input type="text" id="student-name" class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-indigo-500 outline-none transition" placeholder="‡∏î.‡∏ä. ‡∏£‡∏±‡∏Å‡∏î‡∏µ ‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢">
            </div>
            <div class="flex gap-3">
                <div class="w-1/2">
                    <label class="block text-gray-700 font-bold mb-1">‡∏ä‡∏±‡πâ‡∏ô</label>
                    <input type="text" id="student-class" class="w-full border-2 border-gray-300 rounded-lg p-3" placeholder="‡∏õ.4/1">
                </div>
                <div class="w-1/2">
                    <label class="block text-gray-700 font-bold mb-1">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                    <input type="number" id="student-no" class="w-full border-2 border-gray-300 rounded-lg p-3" placeholder="99">
                </div>
            </div>
        </div>

        <div class="mt-6 bg-yellow-50 p-4 rounded-lg border border-yellow-200 text-sm text-yellow-800">
            <strong>üî• ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö:</strong>
            <ul class="list-disc pl-5 mt-1">
                <li>‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡πà‡∏≤ (Simple)</li>
                <li>‡∏Ñ‡∏≥‡∏Ñ‡∏∏‡∏ì‡∏®‡∏±‡∏û‡∏ó‡πå (Adjectives)</li>
                <li>‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (Negative - don't/doesn't)</li>
                <li>‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Question - Do/Does)</li>
            </ul>
        </div>

        <button onclick="startGame()" class="w-full mt-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transition transform hover:-translate-y-1">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö üöÄ
        </button>
    </div>

    <!-- SCREEN 2: GAMEPLAY -->
    <div id="game-screen" class="hidden w-full max-w-4xl">
        <!-- Progress Header -->
        <div class="bg-white p-4 rounded-xl shadow-sm mb-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-700 font-bold">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div class="font-bold text-gray-800" id="display-name">Guest</div>
                    <div class="text-xs text-gray-500">Level: Advanced</div>
                </div>
            </div>
            
            <div class="flex-1 w-full md:w-auto px-4">
                <div class="flex justify-between text-xs mb-1 font-bold text-gray-500">
                    <span>Progress</span>
                    <span><span id="q-current">1</span> / 40</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div id="progress-bar" class="bg-indigo-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-green-100 px-4 py-2 rounded-lg text-green-800 font-bold whitespace-nowrap">
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score-display">0</span>
            </div>
        </div>

        <!-- Question Area -->
        <div class="bg-white p-6 md:p-10 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
            <!-- Difficulty Badge -->
            <div id="type-badge" class="absolute top-0 right-0 bg-gray-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold uppercase tracking-wider">
                Normal
            </div>

            <p class="text-center text-gray-500 text-lg mb-2">‡∏à‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:</p>
            <h2 id="thai-prompt" class="text-center text-2xl md:text-4xl font-bold text-gray-800 mb-8 leading-relaxed">...</h2>

            <!-- Answer Slots -->
            <div id="slots-container" class="flex flex-wrap justify-center gap-2 mb-8 min-h-[60px]">
                <!-- Slots injected via JS -->
            </div>

            <!-- Choice Buttons -->
            <div id="choices-container" class="flex flex-wrap justify-center gap-3 p-4 bg-gray-50 rounded-xl border border-gray-100 min-h-[80px]">
                <!-- Choices injected via JS -->
            </div>
        </div>

        <!-- Controls -->
        <div class="flex justify-center gap-4">
            <button onclick="resetCurrent()" class="px-6 py-3 bg-gray-200 text-gray-600 font-bold rounded-xl hover:bg-gray-300">
                <i class="fas fa-undo"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
            </button>
            <button id="submit-btn" onclick="checkAnswer()" class="px-10 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transform hover:scale-105 transition">
                ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚úÖ
            </button>
            <button id="next-btn" onclick="nextQuestion()" class="hidden px-10 py-3 bg-green-500 text-white font-bold rounded-xl shadow-lg hover:bg-green-600 transform hover:scale-105 transition">
                ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚û°
            </button>
        </div>
    </div>

    <!-- SCREEN 3: RESULT & REVIEW -->
    <div id="result-screen" class="hidden w-full max-w-4xl animate-fade-in">
        <div class="bg-white p-8 rounded-2xl shadow-xl text-center mb-8">
            <div class="text-6xl mb-4">üèÜ</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</h1>
            <p class="text-gray-500 mb-6">‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            
            <div class="text-6xl font-black text-indigo-600 mb-2 eng-font"><span id="final-score">0</span><span class="text-2xl text-gray-400">/40</span></div>
            
            <!-- Analysis -->
            <div class="grid grid-cols-3 gap-4 max-w-lg mx-auto mt-6 text-sm">
                <div class="p-3 bg-green-50 rounded-lg text-green-700">
                    <div class="font-bold text-xl" id="stat-correct">0</div>
                    <div>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
                </div>
                <div class="p-3 bg-red-50 rounded-lg text-red-700">
                    <div class="font-bold text-xl" id="stat-wrong">0</div>
                    <div>‡∏ú‡∏¥‡∏î</div>
                </div>
                <div class="p-3 bg-blue-50 rounded-lg text-blue-700">
                    <div class="font-bold text-xl" id="stat-percent">0%</div>
                    <div>‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞</div>
                </div>
            </div>
            
            <div class="mt-8 flex justify-center gap-4 no-print">
                <button onclick="toggleReview()" class="px-6 py-3 bg-orange-500 text-white font-bold rounded-lg shadow hover:bg-orange-600">
                    <i class="fas fa-search"></i> ‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î
                </button>
                <button onclick="printCertificate()" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow hover:bg-blue-700">
                    <i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
                </button>
            </div>
        </div>

        <!-- Review Section (Hidden by default) -->
        <div id="review-section" class="hidden bg-white p-6 rounded-2xl shadow-lg border-l-8 border-orange-500 mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2"><i class="fas fa-exclamation-circle text-orange-500"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î</h3>
            <div id="review-list" class="space-y-4">
                <!-- Wrong answers injected here -->
            </div>
        </div>

        <!-- Certificate -->
        <div id="certificate-view" class="w-full bg-white shadow-2xl mx-auto mt-8 max-w-[800px] text-center hidden">
            <div class="certificate-container">
                <div class="certificate-inner">
                    <div class="watermark">CERTIFICATE</div>
                    
                    <!-- Header -->
                    <div class="flex justify-center items-center mb-4">
                        <div class="text-yellow-500 text-4xl mr-2"><i class="fas fa-award"></i></div>
                        <h1 class="text-5xl font-bold text-gray-800 cert-font tracking-wider">Certificate</h1>
                        <div class="text-yellow-500 text-4xl ml-2"><i class="fas fa-award"></i></div>
                    </div>
                    
                    <p class="text-gray-500 uppercase tracking-widest text-sm mb-6">Of Achievement / ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                    
                    <p class="text-lg text-gray-600 mb-2">‡∏Ç‡∏≠‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πà</p>
                    <h2 id="cert-name" class="text-4xl font-bold text-indigo-900 mb-1 border-b-2 border-indigo-200 inline-block px-10 pb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <p id="cert-class" class="text-gray-500 mt-2 text-lg">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà...</p>
                    
                    <div class="mt-6 mb-6">
                        <p class="text-gray-700">‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</p>
                        <p class="text-xl font-bold text-indigo-700 mt-1">"Advanced Sentence Structure"</p>
                        <p class="text-sm text-gray-500">(Affirmative, Negative, Question & Adjectives)</p>
                    </div>

                    <div class="flex justify-center items-center gap-2 mb-8">
                        <div class="text-gray-600">‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="text-5xl font-black text-indigo-600 eng-font border-2 border-indigo-600 rounded-full w-24 h-24 flex items-center justify-center bg-white">
                            <span id="cert-score">0</span>
                        </div>
                        <div class="text-gray-600">‡∏à‡∏≤‡∏Å 40 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                    </div>

                    <div class="flex justify-between items-end text-sm text-gray-500 px-10 mt-10">
                        <div class="text-center">
                            <div id="cert-date" class="border-b border-gray-400 px-4 mb-1 font-bold">...</div>
                            <div>Date</div>
                        </div>
                        <div class="text-center">
                            <div class="w-32 border-b border-gray-400 mb-1 h-6"></div>
                            <div>Teacher's Signature</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 40 QUESTIONS DATABASE ---
        // Types: normal, adj (adjective), neg (negative), quest (question)
        const questionBank = [
            // 1-10: Simple Sentences (Review)
            { id: 1, type: "Normal", thai: "‡∏â‡∏±‡∏ô‡∏Å‡∏¥‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•", words: ["I", "eat", "an", "apple."] },
            { id: 2, type: "Normal", thai: "‡πÄ‡∏Ç‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•", words: ["He", "plays", "football."] },
            { id: 3, type: "Normal", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", words: ["We", "go", "to", "school."] },
            { id: 4, type: "Normal", thai: "‡πÅ‡∏°‡∏ß‡∏ô‡∏≠‡∏ô‡∏ö‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á", words: ["The", "cat", "sleeps", "on", "the", "bed."] },
            { id: 5, type: "Normal", thai: "‡πÅ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô", words: ["Mom", "cooks", "dinner."] },
            { id: 6, type: "Normal", thai: "‡∏û‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠", words: ["Dad", "reads", "a", "book."] },
            { id: 7, type: "Normal", thai: "‡∏â‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô", words: ["I", "love", "my", "family."] },
            { id: 8, type: "Normal", thai: "‡∏ô‡∏Å‡∏ö‡∏¥‡∏ô‡πÉ‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤", words: ["Birds", "fly", "in", "the", "sky."] },
            { id: 9, type: "Normal", thai: "‡πÄ‡∏ò‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢", words: ["She", "writes", "a", "letter."] },
            { id: 10, type: "Normal", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏Ç‡∏≤‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥", words: ["They", "drink", "water."] },

            // 11-20: Adjectives (Subject + Verb + Adj + Object)
            { id: 11, type: "Adjective", thai: "‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏£‡∏ñ‡∏™‡∏µ‡πÅ‡∏î‡∏á", words: ["I", "have", "a", "red", "car."] },
            { id: 12, type: "Adjective", thai: "‡πÄ‡∏ò‡∏≠‡∏ä‡∏≠‡∏ö‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏™‡∏ß‡∏¢‡πÜ", words: ["She", "likes", "beautiful", "flowers."] },
            { id: 13, type: "Adjective", thai: "‡πÄ‡∏Ç‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡πá‡∏Å‡∏î‡∏µ", words: ["He", "is", "a", "good", "boy."] },
            { id: 14, type: "Adjective", thai: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á", words: ["The", "big", "dog", "is", "running."] },
            { id: 15, type: "Adjective", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡πá‡∏Å", words: ["We", "live", "in", "a", "small", "house."] },
            { id: 16, type: "Adjective", thai: "‡∏ã‡∏∏‡∏õ‡∏ô‡∏µ‡πâ‡∏£‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡∏Å", words: ["This", "soup", "is", "very", "hot."] },
            { id: 17, type: "Adjective", thai: "‡∏â‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏°‡∏ß‡∏™‡∏µ‡∏î‡∏≥", words: ["I", "see", "a", "black", "cat."] },
            { id: 18, type: "Adjective", thai: "‡∏û‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏™‡∏π‡∏á", words: ["My", "father", "is", "tall."] },
            { id: 19, type: "Adjective", thai: "‡πÄ‡∏ò‡∏≠‡∏™‡∏ß‡∏°‡∏ä‡∏∏‡∏î‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π", words: ["She", "wears", "a", "pink", "dress."] },
            { id: 20, type: "Adjective", thai: "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•‡∏°‡∏µ‡∏£‡∏™‡∏´‡∏ß‡∏≤‡∏ô", words: ["Apples", "are", "sweet."] },

            // 21-30: Negative (Subject + do/does + not + Verb)
            { id: 21, type: "Negative", thai: "‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏á‡∏π", words: ["I", "do", "not", "like", "snakes."] },
            { id: 22, type: "Negative", thai: "‡πÄ‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡∏ú‡∏±‡∏Å", words: ["He", "does", "not", "eat", "vegetables."] },
            { id: 23, type: "Negative", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏ó‡∏ô‡∏ô‡∏¥‡∏™", words: ["We", "do", "not", "play", "tennis."] },
            { id: 24, type: "Negative", thai: "‡πÄ‡∏ò‡∏≠‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏°‡∏Å‡∏≤‡πÅ‡∏ü", words: ["She", "does", "not", "drink", "coffee."] },
            { id: 25, type: "Negative", thai: "‡πÅ‡∏°‡∏ß‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏ô‡πâ‡∏≥", words: ["Cats", "do", "not", "like", "water."] },
            { id: 26, type: "Negative", thai: "‡∏à‡∏≠‡∏£‡πå‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", words: ["George", "does", "not", "go", "to", "school."] },
            { id: 27, type: "Negative", thai: "‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏µ‡πà‡∏ä‡∏≤‡∏¢", words: ["I", "do", "not", "have", "a", "brother."] },
            { id: 28, type: "Negative", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏Ç‡∏≤‡πÑ‡∏°‡πà‡∏î‡∏π‡∏ó‡∏µ‡∏ß‡∏µ", words: ["They", "do", "not", "watch", "TV."] },
            { id: 29, type: "Negative", thai: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏Å‡∏±‡∏î", words: ["That", "dog", "does", "not", "bite."] },
            { id: 30, type: "Negative", thai: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£", words: ["Mom", "does", "not", "cook."] },

            // 31-40: Questions (Do/Does + Subject + Verb?)
            { id: 31, type: "Question", thai: "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡πÑ‡∏´‡∏°?", words: ["Do", "you", "like", "pizza?"] },
            { id: 32, type: "Question", thai: "‡πÄ‡∏ò‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡∏µ‡∏¢‡πÇ‡∏ô‡πÑ‡∏´‡∏°?", words: ["Does", "she", "play", "the", "piano?"] },
            { id: 33, type: "Question", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏Ç‡∏≤‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏´‡∏°?", words: ["Do", "they", "eat", "rice?"] },
            { id: 34, type: "Question", thai: "‡πÄ‡∏Ç‡∏≤‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏´‡∏°?", words: ["Does", "he", "run", "fast?"] },
            { id: 35, type: "Question", thai: "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÑ‡∏´‡∏°?", words: ["Do", "you", "have", "a", "pen?"] },
            { id: 36, type: "Question", thai: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡πÄ‡∏´‡πà‡∏≤‡πÑ‡∏´‡∏°?", words: ["Does", "the", "dog", "bark?"] },
            { id: 37, type: "Question", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏°?", words: ["Do", "we", "have", "homework?"] },
            { id: 38, type: "Question", thai: "‡∏û‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°?", words: ["Does", "your", "dad", "work?"] },
            { id: 39, type: "Question", thai: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡πÑ‡∏´‡∏°?", words: ["Do", "you", "want", "ice", "cream?"] },
            { id: 40, type: "Question", thai: "‡πÄ‡∏ò‡∏≠‡∏û‡∏π‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÑ‡∏´‡∏°?", words: ["Does", "she", "speak", "English?"] }
        ];

        // --- GAME STATE ---
        let currentIdx = 0;
        let score = 0;
        let userAnswers = []; // Store {question, userAns, correctAns, isCorrect}
        let currentSlots = [];
        let shuffledWords = [];
        
        // --- INITIALIZATION ---
        function startGame() {
            const name = document.getElementById('student-name').value.trim();
            const cls = document.getElementById('student-class').value.trim();
            if (!name) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏ö"); return; }
            
            document.getElementById('display-name').innerText = name;
            
            // Switch Screens
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            currentIdx = 0;
            score = 0;
            userAnswers = [];
            loadQuestion();
        }

        function loadQuestion() {
            const q = questionBank[currentIdx];
            
            // UI Updates
            document.getElementById('q-current').innerText = currentIdx + 1;
            document.getElementById('progress-bar').style.width = `${((currentIdx) / 40) * 100}%`;
            document.getElementById('thai-prompt').innerText = `"${q.thai}"`;
            document.getElementById('score-display').innerText = score;
            
            // Badge Color
            const badge = document.getElementById('type-badge');
            badge.innerText = q.type;
            if(q.type === 'Normal') badge.className = "absolute top-0 right-0 bg-blue-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold uppercase";
            else if(q.type === 'Adjective') badge.className = "absolute top-0 right-0 bg-purple-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold uppercase";
            else if(q.type === 'Negative') badge.className = "absolute top-0 right-0 bg-red-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold uppercase";
            else if(q.type === 'Question') badge.className = "absolute top-0 right-0 bg-orange-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold uppercase";

            // Buttons Logic
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            // Reset Data
            currentSlots = new Array(q.words.length).fill(null);
            
            // Render Slots
            const slotsContainer = document.getElementById('slots-container');
            slotsContainer.innerHTML = '';
            q.words.forEach((_, i) => {
                const slot = document.createElement('div');
                slot.id = `slot-${i}`;
                slot.className = "slot w-auto min-w-[60px] h-12 px-2 rounded-lg flex items-center justify-center text-lg font-bold eng-font cursor-pointer text-gray-400 select-none";
                slot.innerText = "";
                slot.onclick = () => returnWord(i);
                slotsContainer.appendChild(slot);
            });

            // Render Choices (Shuffled)
            shuffledWords = [...q.words].sort(() => Math.random() - 0.5);
            renderChoices();
        }

        function renderChoices() {
            const container = document.getElementById('choices-container');
            container.innerHTML = '';
            shuffledWords.forEach((word, index) => {
                if (word !== null) { // Only render if not in slot
                    const btn = document.createElement('button');
                    btn.className = "eng-font px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg shadow-sm font-bold hover:bg-indigo-50 hover:border-indigo-300 active:scale-95 transition text-lg";
                    btn.innerText = word;
                    btn.onclick = () => fillSlot(word, index);
                    container.appendChild(btn);
                }
            });
        }

        function fillSlot(word, wordIndex) {
            // Find first empty slot
            const emptyIdx = currentSlots.findIndex(s => s === null);
            if (emptyIdx !== -1) {
                currentSlots[emptyIdx] = word;
                shuffledWords[wordIndex] = null; // Remove from choice pool temporarily
                updateSlotVisuals();
                renderChoices();
            }
        }

        function returnWord(slotIndex) {
            const word = currentSlots[slotIndex];
            if (word) {
                currentSlots[slotIndex] = null;
                // Find first null in shuffledWords to put it back (or just push)
                // Better approach: Find original instance or just append. 
                // Simple approach: append to list then re-render handled by logic
                const nullIdx = shuffledWords.indexOf(null);
                if (nullIdx !== -1) shuffledWords[nullIdx] = word;
                else shuffledWords.push(word);
                
                updateSlotVisuals();
                renderChoices();
            }
        }

        function updateSlotVisuals() {
            currentSlots.forEach((word, i) => {
                const slot = document.getElementById(`slot-${i}`);
                if (word) {
                    slot.className = "slot filled w-auto min-w-[60px] h-12 px-4 rounded-lg flex items-center justify-center text-lg font-bold eng-font cursor-pointer text-indigo-700 shadow-sm";
                    slot.innerText = word;
                } else {
                    slot.className = "slot w-auto min-w-[60px] h-12 px-2 rounded-lg flex items-center justify-center text-lg font-bold eng-font cursor-pointer text-gray-300";
                    slot.innerText = "___";
                }
            });
        }

        function checkAnswer() {
            if (currentSlots.includes(null)) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }

            const q = questionBank[currentIdx];
            const userString = currentSlots.join(" ");
            const correctString = q.words.join(" ");
            const isCorrect = userString === correctString;

            // Update Score
            if (isCorrect) score++;

            // Record Result
            userAnswers.push({
                id: q.id,
                thai: q.thai,
                userAns: userString,
                correctAns: correctString,
                isCorrect: isCorrect
            });

            // Visual Feedback on Slots
            currentSlots.forEach((_, i) => {
                const slot = document.getElementById(`slot-${i}`);
                if (isCorrect) slot.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                else slot.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
            });

            // Buttons
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questionBank.length) {
                loadQuestion();
            } else {
                finishGame();
            }
        }

        // --- END GAME & REPORT ---
        function finishGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            // Set Stats
            document.getElementById('final-score').innerText = score;
            document.getElementById('stat-correct').innerText = score;
            document.getElementById('stat-wrong').innerText = 40 - score;
            document.getElementById('stat-percent').innerText = Math.round((score/40)*100) + "%";

            // Prepare Review Section
            const reviewList = document.getElementById('review-list');
            reviewList.innerHTML = '';
            
            const wrongAnswers = userAnswers.filter(a => !a.isCorrect);
            
            if (wrongAnswers.length === 0) {
                reviewList.innerHTML = '<div class="text-center text-green-600 font-bold py-4">‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ üéâ</div>';
            } else {
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "bg-gray-50 p-4 rounded-lg border border-gray-200 text-left";
                    div.innerHTML = `
                        <div class="text-gray-800 font-bold mb-1">"${item.thai}"</div>
                        <div class="flex flex-col md:flex-row gap-2 text-sm eng-font">
                            <div class="text-red-500"><i class="fas fa-times"></i> ‡∏ï‡∏≠‡∏ö: ${item.userAns}</div>
                            <div class="text-green-600"><i class="fas fa-check"></i> ‡πÄ‡∏â‡∏•‡∏¢: ${item.correctAns}</div>
                        </div>
                    `;
                    reviewList.appendChild(div);
                });
            }

            // Fill Certificate Data
            document.getElementById('cert-name').innerText = document.getElementById('student-name').value;
            const cls = document.getElementById('student-class').value;
            const no = document.getElementById('student-no').value;
            document.getElementById('cert-class').innerText = `‡∏ä‡∏±‡πâ‡∏ô ${cls} ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${no}`;
            document.getElementById('cert-score').innerText = score;
            
            const d = new Date();
            const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
            document.getElementById('cert-date').innerText = `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
            
            // Show Certificate automatically
            document.getElementById('certificate-view').classList.remove('hidden');
        }

        function toggleReview() {
            const section = document.getElementById('review-section');
            section.classList.toggle('hidden');
            // Smooth scroll to review
            if(!section.classList.contains('hidden')) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function printCertificate() {
            // Hide everything except certificate for printing
            window.print();
        }

        // --- UTILS ---
        function resetCurrent() {
             // Reload current question to reset slots
             loadQuestion();
        }

    </script>
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            #certificate-view, #certificate-view * {
                visibility: visible;
            }
            #certificate-view {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</body>
</html>